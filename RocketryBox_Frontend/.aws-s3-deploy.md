# AWS S3 Static Website Deployment Guide

This guide provides step-by-step instructions for manually deploying the RocketryBox Frontend to AWS S3 as a static website.

## Prerequisites

- AWS CLI installed and configured
- Node.js 18+ installed
- Access to AWS account with S3 permissions

## Step 1: Build the Application

```bash
# Install dependencies
npm ci

# Create environment file with production values
echo "VITE_BACKEND_URL=https://your-backend-url.com" >> .env
echo "GOOGLE_MAPS_API_KEY=your_google_maps_api_key" >> .env
echo "TINYMCE_API_KEY=your_tinymce_api_key" >> .env
echo "VITE_SHOPIFY_CLIENT_ID=your_shopify_client_id" >> .env

# Build the application
npm run build

# Create health check file
echo '{"status":"healthy","service":"rocketrybox-frontend","timestamp":"'$(date -Iseconds)'"}' > dist/health.json
```

## Step 2: Create S3 Bucket

```bash
# Replace 'your-unique-bucket-name' with your desired bucket name
BUCKET_NAME="your-unique-bucket-name"

# Create the bucket
aws s3 mb s3://$BUCKET_NAME --region ap-south-1

# Enable static website hosting
aws s3 website s3://$BUCKET_NAME \
  --index-document index.html \
  --error-document index.html
```

## Step 3: Apply Bucket Policy

```bash
# Apply the bucket policy for public read access
# First, update the bucket name in aws-s3-bucket-policy.json
sed "s/YOUR_BUCKET_NAME/$BUCKET_NAME/g" aws-s3-bucket-policy.json > temp-bucket-policy.json

# Apply the policy
aws s3api put-bucket-policy \
  --bucket $BUCKET_NAME \
  --policy file://temp-bucket-policy.json

# Clean up temporary file
rm temp-bucket-policy.json
```

## Step 4: Deploy Files

```bash
# Sync all files to S3
aws s3 sync dist/ s3://$BUCKET_NAME \
  --delete \
  --region ap-south-1

# Set proper content types for specific files
aws s3 cp dist/index.html s3://$BUCKET_NAME/index.html \
  --content-type "text/html" \
  --metadata-directive REPLACE

# Set cache headers for assets
aws s3 sync dist/assets/ s3://$BUCKET_NAME/assets/ \
  --cache-control "max-age=31536000" \
  --region ap-south-1
```

## Step 5: Get Website URL

```bash
# Get the website endpoint URL
echo "Website URL: http://$BUCKET_NAME.s3-website.ap-south-1.amazonaws.com"
```

## Step 6: Test Deployment

```bash
# Test the health endpoint
curl http://$BUCKET_NAME.s3-website.ap-south-1.amazonaws.com/health.json

# Test the main application
curl -I http://$BUCKET_NAME.s3-website.ap-south-1.amazonaws.com
```

## Environment Variables Required

Make sure to set these environment variables before building:

- `VITE_BACKEND_URL` - Your backend API URL
- `GOOGLE_MAPS_API_KEY` - Google Maps API key
- `TINYMCE_API_KEY` - TinyMCE API key  
- `VITE_SHOPIFY_CLIENT_ID` - Shopify client ID

## GitHub Secrets Required

For the GitHub Actions workflow to work, configure these secrets in your repository:

- `AWS_ACCESS_KEY_ID` - AWS access key
- `AWS_SECRET_ACCESS_KEY` - AWS secret key
- `AWS_S3_BUCKET` - S3 bucket name
- `CLOUDFRONT_DISTRIBUTION_ID` - CloudFront distribution ID (optional)
- `VITE_BACKEND_URL` - Backend API URL
- `GOOGLE_MAPS_API_KEY` - Google Maps API key
- `TINYMCE_API_KEY` - TinyMCE API key
- `VITE_SHOPIFY_CLIENT_ID` - Shopify client ID

## Troubleshooting

### Build Fails
- Ensure all environment variables are set
- Check Node.js version (requires 18+)
- Run `npm ci` to ensure clean dependency installation

### S3 Upload Fails
- Verify AWS credentials are configured
- Check bucket permissions
- Ensure bucket policy is applied correctly

### 404 Errors on Refresh
- Ensure error document is set to `index.html` for SPA routing
- Verify all routes are handled by React Router

### API Calls Fail
- Check `VITE_BACKEND_URL` is correctly set
- Ensure CORS is configured on the backend
- Verify backend is accessible from the deployed domain 